{% extends 'attendance/base.html' %}

{% block title %}Admin Dashboard — PARACH ICT Academy{% endblock %}

{% block extra_head %}
<style>

    /* ══════════════════════════════════════
       PAGE SHELL
    ══════════════════════════════════════ */
    .dash-page {
        width: 100%;
        max-width: 1100px;
        animation: dash-in 0.7s cubic-bezier(0.23,1,0.32,1) forwards;
        opacity: 0;
        transform: translateY(20px);
    }

    @keyframes dash-in {
        to { opacity:1; transform:translateY(0); }
    }

    /* ══════════════════════════════════════
       PAGE HEADER ROW
    ══════════════════════════════════════ */
    .dash-header {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 14px;
        margin-bottom: 28px;
    }

    .dash-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-primary);
        letter-spacing: 0.3px;
        line-height: 1;
        margin-bottom: 5px;
    }

    .dash-date-label {
        font-family: var(--font-mono);
        font-size: 11px;
        color: var(--text-dim);
        letter-spacing: 1px;
    }

    .dash-date-label strong {
        color: var(--neon-cyan);
        font-weight: 400;
    }

    .dash-admin-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .btn-action {
        display: inline-flex;
        align-items: center;
        gap: 7px;
        padding: 9px 16px;
        border-radius: 4px;
        font-family: var(--font-mono);
        font-size: 11px;
        letter-spacing: 1px;
        text-transform: uppercase;
        text-decoration: none;
        transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
        cursor: pointer;
        border: none;
    }

    .btn-action-cyan {
        background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
        color: var(--dark-bg);
        box-shadow: 0 0 18px rgba(0,245,255,0.2);
        font-weight: 700;
    }

    .btn-action-cyan:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 30px rgba(0,245,255,0.35);
    }

    .btn-action-ghost {
        background: transparent;
        color: var(--text-dim);
        border: 1px solid rgba(0,245,255,0.18);
    }

    .btn-action-ghost:hover {
        color: var(--neon-cyan);
        border-color: rgba(0,245,255,0.35);
        background: rgba(0,245,255,0.05);
    }

    /* ══════════════════════════════════════
       STAT CARDS
    ══════════════════════════════════════ */
    .stat-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 28px;
    }

    .stat-card {
        background: var(--panel-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 6px;
        padding: 20px 22px;
        position: relative;
        overflow: hidden;
        transition: border-color 0.3s, box-shadow 0.3s;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0;
        width: 3px; height: 100%;
        border-radius: 6px 0 0 6px;
    }

    .stat-card:hover {
        border-color: rgba(0,245,255,0.22);
        box-shadow: 0 0 24px rgba(0,245,255,0.05);
    }

    .stat-card.cyan::before  { background: var(--neon-cyan); box-shadow: 0 0 12px var(--neon-cyan); }
    .stat-card.green::before { background: var(--neon-green); box-shadow: 0 0 12px var(--neon-green); }
    .stat-card.blue::before  { background: var(--neon-blue);  box-shadow: 0 0 12px var(--neon-blue); }
    .stat-card.yellow::before{ background: var(--neon-yellow);box-shadow: 0 0 12px var(--neon-yellow);}

    .stat-icon {
        width: 34px; height: 34px;
        border-radius: 4px;
        display: flex; align-items: center; justify-content: center;
        margin-bottom: 14px;
        flex-shrink: 0;
    }

    .stat-icon.cyan   { background: rgba(0,245,255,0.1);   border: 1px solid rgba(0,245,255,0.2);  }
    .stat-icon.green  { background: rgba(0,255,136,0.1);   border: 1px solid rgba(0,255,136,0.2);  }
    .stat-icon.blue   { background: rgba(0,128,255,0.1);   border: 1px solid rgba(0,128,255,0.2);  }
    .stat-icon.yellow { background: rgba(255,204,0,0.1);   border: 1px solid rgba(255,204,0,0.2);  }

    .stat-value {
        font-size: 34px;
        font-weight: 800;
        color: var(--text-primary);
        line-height: 1;
        margin-bottom: 5px;
        letter-spacing: -1px;
    }

    .stat-label {
        font-family: var(--font-mono);
        font-size: 10px;
        color: var(--text-dim);
        letter-spacing: 1.5px;
        text-transform: uppercase;
    }

    /* ══════════════════════════════════════
       SUMMARY MINI-CARDS
    ══════════════════════════════════════ */
    .summary-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 28px;
    }

    .summary-card {
        background: var(--panel-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 6px;
        padding: 18px 20px;
        display: flex;
        align-items: center;
        gap: 14px;
        transition: border-color 0.3s;
    }

    .summary-card:hover { border-color: rgba(0,245,255,0.2); }

    .summary-icon {
        width: 38px; height: 38px;
        border-radius: 4px;
        display: flex; align-items: center; justify-content: center;
        flex-shrink: 0;
        background: rgba(0,245,255,0.06);
        border: 1px solid rgba(0,245,255,0.15);
    }

    .summary-content {}

    .summary-val {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
        line-height: 1;
        margin-bottom: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .summary-lbl {
        font-family: var(--font-mono);
        font-size: 9px;
        color: var(--text-dim);
        letter-spacing: 1.2px;
        text-transform: uppercase;
    }

    /* ══════════════════════════════════════
       FILTER BAR
    ══════════════════════════════════════ */
    .filter-card {
        background: var(--panel-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 6px;
        padding: 16px 20px;
        margin-bottom: 20px;
    }

    .filter-label-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
    }

    .filter-label-row span {
        font-family: var(--font-mono);
        font-size: 10px;
        color: var(--neon-cyan);
        opacity: 0.7;
        letter-spacing: 1.5px;
        text-transform: uppercase;
    }

    .filter-form {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
    }

    .filter-input,
    .filter-select {
        padding: 9px 14px;
        background: rgba(0,15,35,0.65);
        border: 1px solid rgba(0,245,255,0.14);
        border-radius: 4px;
        color: var(--text-primary);
        font-size: 13px;
        font-family: var(--font-main);
        outline: none;
        transition: border-color 0.3s, box-shadow 0.3s;
        min-width: 140px;
    }

    .filter-input:focus, .filter-select:focus {
        border-color: var(--neon-cyan);
        box-shadow: 0 0 0 1px rgba(0,245,255,0.13);
    }

    .filter-select {
        appearance: none;
        -webkit-appearance: none;
        padding-right: 32px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='11' viewBox='0 0 24 24' fill='none' stroke='%2300f5ff' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        cursor: pointer;
    }

    .filter-select option { background: #0a1628; color: var(--text-primary); }

    .filter-input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(0.6) sepia(1) saturate(4) hue-rotate(170deg);
        cursor: pointer; opacity: 0.6;
    }

    .btn-filter {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 9px 18px;
        background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
        border: none;
        border-radius: 4px;
        color: var(--dark-bg);
        font-family: var(--font-mono);
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 1px;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow: 0 0 16px rgba(0,245,255,0.2);
        transition: transform 0.2s, box-shadow 0.2s;
        white-space: nowrap;
    }

    .btn-filter:hover { transform: translateY(-1px); box-shadow: 0 0 28px rgba(0,245,255,0.35); }

    .btn-reset {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 9px 16px;
        background: transparent;
        border: 1px solid rgba(0,245,255,0.18);
        border-radius: 4px;
        color: var(--text-dim);
        font-family: var(--font-mono);
        font-size: 11px;
        letter-spacing: 1px;
        text-transform: uppercase;
        text-decoration: none;
        cursor: pointer;
        transition: color 0.2s, border-color 0.2s, background 0.2s;
        white-space: nowrap;
    }

    .btn-reset:hover {
        color: var(--neon-cyan);
        border-color: rgba(0,245,255,0.32);
        background: rgba(0,245,255,0.05);
    }

    /* ══════════════════════════════════════
       TABLE PANEL
    ══════════════════════════════════════ */
    .table-panel {
        background: var(--panel-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 20px;
        position: relative;
    }

    .table-panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 20px;
        border-bottom: 1px solid rgba(0,245,255,0.08);
        flex-wrap: wrap;
        gap: 10px;
    }

    .table-panel-title {
        font-family: var(--font-mono);
        font-size: 11px;
        color: var(--neon-cyan);
        letter-spacing: 1.5px;
        text-transform: uppercase;
        opacity: 0.8;
    }

    .table-record-count {
        font-family: var(--font-mono);
        font-size: 10px;
        color: var(--text-dim);
        letter-spacing: 1px;
    }

    .dash-table {
        width: 100%;
        border-collapse: collapse;
    }

    .dash-table thead tr {
        background: rgba(0,245,255,0.03);
    }

    .dash-table th {
        padding: 11px 18px;
        text-align: left;
        font-family: var(--font-mono);
        font-size: 10px;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        color: var(--neon-cyan);
        opacity: 0.65;
        border-bottom: 1px solid rgba(0,245,255,0.1);
        white-space: nowrap;
    }

    .dash-table td {
        padding: 12px 18px;
        color: var(--text-primary);
        font-size: 13px;
        border-bottom: 1px solid rgba(0,245,255,0.04);
        vertical-align: middle;
    }

    .dash-table tbody tr:last-child td { border-bottom: none; }

    .dash-table tbody tr {
        transition: background 0.18s;
    }

    .dash-table tbody tr:hover {
        background: rgba(0,245,255,0.04);
    }

    /* empty state */
    .table-empty {
        padding: 40px 20px;
        text-align: center;
        font-family: var(--font-mono);
        font-size: 12px;
        color: var(--text-dim);
        letter-spacing: 1px;
    }

    .table-empty svg { margin-bottom: 12px; opacity: 0.3; }

    /* role badge */
    .role-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 3px 9px;
        border-radius: 20px;
        font-family: var(--font-mono);
        font-size: 10px;
        letter-spacing: 0.8px;
        text-transform: uppercase;
    }

    .role-student {
        background: rgba(0,128,255,0.12);
        border: 1px solid rgba(0,128,255,0.25);
        color: #80c8ff;
    }

    .role-tutor {
        background: rgba(0,255,136,0.10);
        border: 1px solid rgba(0,255,136,0.22);
        color: var(--neon-green);
    }

    /* ══════════════════════════════════════
       PAGINATION
    ══════════════════════════════════════ */
    .pagination {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 16px 20px;
        border-top: 1px solid rgba(0,245,255,0.06);
    }

    .page-btn {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 6px 14px;
        border-radius: 4px;
        font-family: var(--font-mono);
        font-size: 11px;
        letter-spacing: 1px;
        text-transform: uppercase;
        text-decoration: none;
        border: 1px solid rgba(0,245,255,0.18);
        color: var(--text-dim);
        background: transparent;
        transition: color 0.2s, border-color 0.2s, background 0.2s;
    }

    .page-btn:hover {
        color: var(--neon-cyan);
        border-color: rgba(0,245,255,0.35);
        background: rgba(0,245,255,0.05);
    }

    .page-info {
        font-family: var(--font-mono);
        font-size: 11px;
        color: var(--text-dim);
        letter-spacing: 1px;
        padding: 0 8px;
    }

    .page-info span { color: var(--neon-cyan); }

    /* ══════════════════════════════════════
       CHARTS GRID
    ══════════════════════════════════════ */
    .charts-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 28px;
    }

    .chart-panel {
        background: var(--panel-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 6px;
        padding: 18px 20px;
        position: relative;
        overflow: hidden;
    }

    .chart-panel::before,
    .chart-panel::after {
        content: '';
        position: absolute;
        width: 14px; height: 14px;
        border-color: var(--neon-cyan);
        border-style: solid;
        opacity: 0.3;
    }

    .chart-panel::before { top:0; left:0; border-width: 1.5px 0 0 1.5px; border-radius: 5px 0 0 0; }
    .chart-panel::after  { bottom:0; right:0; border-width: 0 1.5px 1.5px 0; border-radius: 0 0 5px 0; }

    .chart-title {
        font-family: var(--font-mono);
        font-size: 10px;
        color: var(--neon-cyan);
        letter-spacing: 1.5px;
        text-transform: uppercase;
        opacity: 0.75;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .chart-title-dot {
        width: 5px; height: 5px;
        border-radius: 50%;
        background: var(--neon-cyan);
        box-shadow: 0 0 5px var(--neon-cyan);
    }

    .chart-wrap {
        position: relative;
        height: 200px;
    }

    /* ══════════════════════════════════════
       SECTION DIVIDER
    ══════════════════════════════════════ */
    .section-label {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: var(--font-mono);
        font-size: 10px;
        color: var(--neon-cyan);
        opacity: 0.6;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        margin-bottom: 14px;
    }

    .section-label::after {
        content: '';
        flex: 1;
        height: 1px;
        background: linear-gradient(90deg, rgba(0,245,255,0.2), transparent);
    }

    /* ══════════════════════════════════════
       RESPONSIVE
    ══════════════════════════════════════ */
    @media (max-width: 768px) {
        .charts-grid   { grid-template-columns: 1fr; }
        .summary-grid  { grid-template-columns: 1fr; }
        .dash-header   { flex-direction: column; align-items: flex-start; }
        .dash-table th:nth-child(3),
        .dash-table td:nth-child(3) { display: none; } /* hide course on mobile */
    }

    @media (max-width: 480px) {
        .stat-grid { grid-template-columns: 1fr 1fr; }
        .filter-form { flex-direction: column; align-items: stretch; }
        .filter-input, .filter-select { min-width: unset; width: 100%; }
    }
</style>
{% endblock %}


{% block content %}
<div class="dash-page">

    <!-- ══ PAGE HEADER ══ -->
    <div class="dash-header">
        <div>
            <div class="dash-title">Attendance Dashboard</div>
            <div class="dash-date-label">
                 VIEWING RECORDS FOR:&nbsp;
                <strong>{{ date_filter|date:"F d, Y" }}</strong>
            </div>
        </div>
        <div class="dash-admin-actions">
            <a href="{% url 'add_course' %}" class="btn-action btn-action-ghost">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add Course
            </a>
            <a href="{% url 'add_location' %}" class="btn-action btn-action-ghost">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3"/>
                </svg>
                Add Location
            </a>
        </div>
    </div>

    <!-- ══ TOP STAT CARDS ══ -->
    <div class="stat-grid">
        <div class="stat-card cyan">
            <div class="stat-icon cyan">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#00f5ff" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                </svg>
            </div>
            <div class="stat-value">{{ total_today }}</div>
            <div class="stat-label">Total Records</div>
        </div>

        <div class="stat-card green">
            <div class="stat-icon green">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#00ff88" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
            </div>
            <div class="stat-value">{{ students_today }}</div>
            <div class="stat-label">Students</div>
        </div>

        <div class="stat-card blue">
            <div class="stat-icon blue">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#0080ff" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                    <polyline points="16 11 18 13 22 9"/>
                </svg>
            </div>
            <div class="stat-value">{{ tutors_today }}</div>
            <div class="stat-label">Tutors</div>
        </div>

        <div class="stat-card yellow">
            <div class="stat-icon yellow">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ffcc00" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                </svg>
            </div>
            <div class="stat-value">{{ monthly_total }}</div>
            <div class="stat-label">This Month</div>
        </div>
    </div>

    <!-- ══ MONTHLY SUMMARY MINI-CARDS ══ -->
    <div class="summary-grid">
        <div class="summary-card">
            <div class="summary-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#00f5ff" stroke-width="1.8">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                </svg>
            </div>
            <div class="summary-content">
                <div class="summary-val">{{ monthly_total }}</div>
                <div class="summary-lbl">Monthly Attendance</div>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#00f5ff" stroke-width="1.8">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                </svg>
            </div>
            <div class="summary-content">
                <div class="summary-val">{% if top_course %}{{ top_course.course__name }}{% else %}N/A{% endif %}</div>
                <div class="summary-lbl">Top Course This Month</div>
            </div>
        </div>
    </div>

    <!-- ══ FILTER BAR ══ -->
    <div class="filter-card">
        <div class="filter-label-row">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="#00f5ff" stroke-width="2" opacity="0.6">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
            </svg>
            <span>Filter Records</span>
        </div>
        <form method="get" class="filter-form">
            <input type="date" name="date" value="{{ date_filter|date:'Y-m-d' }}" class="filter-input">

            <select name="user_type" class="filter-select">
                <option value="">All Roles</option>
                <option value="student" {% if user_type_filter == 'student' %}selected{% endif %}>Student</option>
                <option value="tutor"   {% if user_type_filter == 'tutor'   %}selected{% endif %}>Tutor</option>
            </select>

            <select name="course" class="filter-select">
                <option value="">All Courses</option>
                {% for course in courses %}
                <option value="{{ course.id }}" {% if course_filter|add:'' == course.id|stringformat:"s" %}selected{% endif %}>
                    {{ course.name }}
                </option>
                {% endfor %}
            </select>

            <select name="location" class="filter-select">
                <option value="">All Locations</option>
                {% for location in locations %}
                <option value="{{ location.id }}" {% if location_filter|add:'' == location.id|stringformat:"s" %}selected{% endif %}>
                    {{ location.name }}
                </option>
                {% endfor %}
            </select>

            <button type="submit" class="btn-filter">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                Apply
            </button>

            <a href="{% url 'admin_dashboard' %}" class="btn-reset">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="1 4 1 10 7 10"/>
                    <path d="M3.51 15a9 9 0 1 0 .49-3.5"/>
                </svg>
                Reset
            </a>
        </form>
    </div>

    <!-- ══ ATTENDANCE TABLE ══ -->
    <div class="section-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/>
            <line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/>
            <line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
        </svg>
        Attendance Records
    </div>

    <div class="table-panel">
        <div class="table-panel-header">
            <div class="table-panel-title"> SIGN-IN LOG</div>
            <div class="table-record-count" id="liveTotal">
                {{ total_today }} record{% if total_today != 1 %}s{% endif %}
            </div>
        </div>

        <table class="dash-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Course</th>
                    <th>Check-In Time</th>
                </tr>
            </thead>
            <tbody>
                {% for attendance in attendances %}
                <tr>
                    <td>{{ attendance.user.get_full_name|default:attendance.user.username }}</td>
                    <td>
                        <span class="role-badge {% if attendance.user.get_user_type_display == 'Student' %}role-student{% else %}role-tutor{% endif %}">
                            {{ attendance.user.get_user_type_display }}
                        </span>
                    </td>
                    <td>{{ attendance.course.name }}</td>
                    <td>
                        <span style="font-family:var(--font-mono); font-size:12px; color:var(--text-dim);">
                            {{ attendance.check_in_time|date:"Y-m-d" }}
                        </span>
                        &nbsp;
                        <span style="font-family:var(--font-mono); font-size:12px; color:var(--neon-cyan); opacity:0.8;">
                            {{ attendance.check_in_time|date:"H:i" }}
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">
                        <div class="table-empty">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#00f5ff" stroke-width="1.2" style="display:block;margin:0 auto 10px;">
                                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                            </svg>
                            NO RECORDS FOUND FOR THIS FILTER
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        {% if attendances.has_previous or attendances.has_next %}
        <div class="pagination">
            {% if attendances.has_previous %}
            <a href="?page={{ attendances.previous_page_number }}" class="page-btn">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"/>
                </svg>
                Prev
            </a>
            {% endif %}

            <div class="page-info">
                Page <span>{{ attendances.number }}</span> of <span>{{ attendances.paginator.num_pages }}</span>
            </div>

            {% if attendances.has_next %}
            <a href="?page={{ attendances.next_page_number }}" class="page-btn">
                Next
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"/>
                </svg>
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- ══ CHARTS ══ -->
    <div class="section-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="14"/>
        </svg>
        Analytics
    </div>

    <div class="charts-grid">
        <div class="chart-panel">
            <div class="chart-title">
                <div class="chart-title-dot"></div>
                Attendance / Course
            </div>
            <div class="chart-wrap">
                <canvas id="courseChart"></canvas>
            </div>
        </div>
        <div class="chart-panel">
            <div class="chart-title">
                <div class="chart-title-dot" style="background:var(--neon-blue);box-shadow:0 0 5px var(--neon-blue);"></div>
                Attendance / Location
            </div>
            <div class="chart-wrap">
                <canvas id="locationChart"></canvas>
            </div>
        </div>
    </div>

</div><!-- /dash-page -->
{% endblock %}


{% block extra_scripts %}
<!-- Chart data from Django context -->
<script id="course-labels-data"   type="application/json">{{ course_labels|default:"[]"|safe }}</script>
<script id="course-totals-data"   type="application/json">{{ course_totals|default:"[]"|safe }}</script>
<script id="location-labels-data" type="application/json">{{ location_labels|default:"[]"|safe }}</script>
<script id="location-totals-data" type="application/json">{{ location_totals|default:"[]"|safe }}</script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    /* ── Shared chart defaults ── */
    Chart.defaults.color          = 'rgba(180,220,255,0.55)';
    Chart.defaults.borderColor    = 'rgba(0,245,255,0.07)';
    Chart.defaults.font.family    = "'Share Tech Mono', monospace";
    Chart.defaults.font.size      = 11;

    /* ── Course bar chart ── */
    const courseLabels = JSON.parse(document.getElementById('course-labels-data').textContent);
    const courseTotals = JSON.parse(document.getElementById('course-totals-data').textContent);

    if (courseLabels.length > 0) {
        new Chart(document.getElementById('courseChart'), {
            type: 'bar',
            data: {
                labels: courseLabels,
                datasets: [{
                    label: 'Check-ins',
                    data: courseTotals,
                    backgroundColor: 'rgba(0,245,255,0.18)',
                    borderColor:     'rgba(0,245,255,0.75)',
                    borderWidth: 1.5,
                    borderRadius: 3,
                    hoverBackgroundColor: 'rgba(0,245,255,0.30)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(5,10,20,0.92)',
                        borderColor: 'rgba(0,245,255,0.25)',
                        borderWidth: 1,
                        titleColor: '#00f5ff',
                        bodyColor: 'rgba(180,220,255,0.8)',
                        padding: 10,
                        cornerRadius: 4,
                    }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(0,245,255,0.05)' },
                        ticks: { color: 'rgba(180,220,255,0.45)', maxRotation: 30 }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0,245,255,0.06)' },
                        ticks: { color: 'rgba(180,220,255,0.45)', stepSize: 1 }
                    }
                }
            }
        });
    }

    /* ── Location doughnut chart ── */
    const locationLabels = JSON.parse(document.getElementById('location-labels-data').textContent);
    const locationTotals = JSON.parse(document.getElementById('location-totals-data').textContent);

    if (locationLabels.length > 0) {
        const palette = [
            'rgba(0,245,255,0.70)',
            'rgba(0,128,255,0.70)',
            'rgba(123,47,255,0.70)',
            'rgba(0,255,136,0.70)',
            'rgba(255,204,0,0.70)',
            'rgba(255,50,80,0.70)',
        ];
        const borders = palette.map(c => c.replace('0.70','1'));

        new Chart(document.getElementById('locationChart'), {
            type: 'doughnut',
            data: {
                labels: locationLabels,
                datasets: [{
                    data: locationTotals,
                    backgroundColor: palette.slice(0, locationLabels.length),
                    borderColor:     borders.slice(0, locationLabels.length),
                    borderWidth: 1.5,
                    hoverOffset: 6,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '62%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: 'rgba(180,220,255,0.55)',
                            boxWidth: 10,
                            padding: 14,
                            font: { size: 10 }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(5,10,20,0.92)',
                        borderColor: 'rgba(0,245,255,0.25)',
                        borderWidth: 1,
                        titleColor: '#00f5ff',
                        bodyColor: 'rgba(180,220,255,0.8)',
                        padding: 10,
                        cornerRadius: 4,
                    }
                }
            }
        });
    }
});

/* ── Live stats refresh every 10s ── */
setInterval(() => {
    fetch("/attendance/live-stats/")
        .then(r => r.json())
        .then(data => {
            const el = document.getElementById("liveTotal");
            if (el && data.total !== undefined) {
                el.textContent = data.total + (data.total !== 1 ? ' records' : ' record');
            }
        })
        .catch(() => {});
}, 10000);
</script>
{% endblock %}